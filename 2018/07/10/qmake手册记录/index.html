<!DOCTYPE html>
<html lang="zh-Hans">
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="Yuci Cheung" />



<meta name="description" content="qmake基本概念介绍; pro文件编写示例; pro文件高级编写语法。qmake是Trolltech公司创建的主要用来给qt项目在不同平台和编译器书写Makefile的工具。用qmake，开发者可以创建一个简单的“项目”(.pro文件)然后运行qmake在不同平台下生成适当的Makefile。">
<meta name="keywords" content="跨平台编译,qmake">
<meta property="og:type" content="article">
<meta property="og:title" content="qmake手册记录">
<meta property="og:url" content="https://yucicheung.github.io/2018/07/10/qmake手册记录/index.html">
<meta property="og:site_name" content="Yuci&#39;s Blog">
<meta property="og:description" content="qmake基本概念介绍; pro文件编写示例; pro文件高级编写语法。qmake是Trolltech公司创建的主要用来给qt项目在不同平台和编译器书写Makefile的工具。用qmake，开发者可以创建一个简单的“项目”(.pro文件)然后运行qmake在不同平台下生成适当的Makefile。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://yucicheung.github.io/2018/07/10/qmake手册记录/pics/qt_makespec.png">
<meta property="og:updated_time" content="2018-07-09T16:33:54.384Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="qmake手册记录">
<meta name="twitter:description" content="qmake基本概念介绍; pro文件编写示例; pro文件高级编写语法。qmake是Trolltech公司创建的主要用来给qt项目在不同平台和编译器书写Makefile的工具。用qmake，开发者可以创建一个简单的“项目”(.pro文件)然后运行qmake在不同平台下生成适当的Makefile。">
<meta name="twitter:image" content="https://yucicheung.github.io/2018/07/10/qmake手册记录/pics/qt_makespec.png">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="Yuci&#39;s Blog" type="application/atom+xml">



    <link rel="shortcut icon" href="/egg.png">





    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">



<link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">


<title>qmake手册记录 | Yuci&#39;s Blog</title>

<script src="//cdn.jsdelivr.net/gh/jquery/jquery@3.2.1/dist/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.1/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: false,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdnjs.cloudflare.com/ajax/libs/fancybox/3.3.5/jquery.fancybox.min.js",
        scrollreveal: "//cdnjs.cloudflare.com/ajax/libs/scrollReveal.js/3.4.0/scrollreveal.min.js",
        search: true
    }
</script>


    <script> yiliaConfig.jquery_ui = [false]; </script>



    <script> yiliaConfig.rootUrl = "\/";</script>



    <script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5aa6360dad8cb1a6"></script>



    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?bd6df76638422f4466c5d6bd0c572265";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
        })();
    </script>


</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">Yuci Cheung</a></h1>
        </hgroup>

        
        <p class="header-subtitle">Coding for fun.</p>
        

        
            <form id="search-form">
            <input type="text" id="local-search-input" name="q" placeholder="search..." class="search form-control" autocomplete="off" autocorrect="off" searchonload="false" />
            <i class="fa fa-times" onclick="resetSearch()"></i>
            </form>
            <div id="local-search-result"></div>
            <p class='no-result'>No results found <i class='fa fa-spinner fa-pulse'></i></p>
        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:yucicheung@gmail.com" title="Email"></a>
                            
                                <a class="fa GitHub" href="https://github.com/yucicheung" title="GitHub"></a>
                            
                                <a class="fa CSDN" href="http://blog.csdn.net/yucicheung" title="CSDN"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/">C++</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CDN/">CDN</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Grub/">Grub</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Notes/">Notes</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OOP/">OOP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Recommendation/">Recommendation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSL/">SSL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shell/">Shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ubuntu/">Ubuntu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/c/">c++</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cmake/">cmake</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/design-patterns/">design patterns</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/">github</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/matlab/">matlab</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mutex/">mutex</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/qmake/">qmake</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/qt/">qt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/书写规范/">书写规范</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/多线程/">多线程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/工具/">工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据结构/">数据结构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/正则表达式/">正则表达式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/算法/">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/编译/">编译</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/自制小工具/">自制小工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/跨平台编译/">跨平台编译</a></li></ul>
                    </div>
                </section>
                
                
                

                
                
                <section class="switch-part switch-part3">
                
                    <div id="js-aboutme">预备役程序员。</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">Yuci Cheung</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">Yuci Cheung</a></h1>
            </hgroup>
            
            <p class="header-subtitle">Coding for fun.</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:yucicheung@gmail.com" title="Email"></a>
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/yucicheung" title="GitHub"></a>
                            
                                <a class="fa CSDN" target="_blank" href="http://blog.csdn.net/yucicheung" title="CSDN"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap"><article id="post-qmake手册记录" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/07/10/qmake手册记录/" class="article-date">
      <time datetime="2018-07-09T16:16:08.000Z" itemprop="datePublished">2018-07-10</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      qmake手册记录
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Documenting/">Documenting</a>
    </div>


        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/qmake/">qmake</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/跨平台编译/">跨平台编译</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p><excerpt in="" index="" |="" 首页摘要=""> </excerpt></p>
<ul>
<li><code>qmake</code>基本概念介绍;</li>
<li><code>pro</code>文件编写示例;</li>
<li><code>pro</code>文件高级编写语法。<br><code>qmake</code>是Trolltech公司创建的主要用来给qt项目在<strong>不同平台和编译器书写Makefile的工具</strong>。用<code>qmake</code>，开发者可以创建一个简单的“项目”(.pro文件)然后运行<code>qmake</code>在不同平台下生成适当的Makefile。<a id="more"></a>
<the rest="" of="" contents="" |="" 余下全文="">

</the></li>
</ul>
<h2 id="qmake相关基本概念"><a href="#qmake相关基本概念" class="headerlink" title="qmake相关基本概念"></a>qmake相关基本概念</h2><h3 id="几个名词说明"><a href="#几个名词说明" class="headerlink" title="几个名词说明"></a>几个名词说明</h3><ul>
<li><p><strong><code>QMAKESPEC</code>环境变量</strong></p>
<ul>
<li><strong>必须设置为你当前所使用的平台和编译器的组合</strong>，否则跨平台编译不会成功。比如，如你使用的是win+msvc，就该把环境变量设为win32-msvc，如果使用的是Solaris和g++，就该设置为solaris-g++。</li>
<li>在<code>qt/mkspecs</code>中的每一个目录里面，都有一个包含平台和编译器特定信息的<code>qmake.conf</code>文件，这些设置适用于你要使用<code>qmake</code>的任何项目，一般不要进行修改，</li>
</ul>
</li>
<li><p>项目(.pro)文件</p>
<ul>
<li>用于告诉qmake关于为这个应用程序创建makefile所需要的细节，如，一个源文件和头文件的列表，任何应用程序特定配置(如一个必须要连接的额外库、或者一个额外的包含路径)，都应该放到<code>.pro</code>项目文件中。</li>
</ul>
</li>
<li><p><code>#</code>注释</p>
<ul>
<li>可以用<code>#</code>号为项目文件添加注释。注释由”#”符号开始，直到这行结束。</li>
</ul>
</li>
</ul>
<h3 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h3><p>模板变量告诉<code>qmake</code>为这个应用程序生成哪种makefile，有以下可供使用的选择：</p>
<ul>
<li><code>app</code>：建立一个应用程序的makefile。这是<strong>默认值</strong>，如果模板没有被指定，这个就会被使用;</li>
<li><code>lib</code>：建立一个库的makefile(库的文件结构关系，如何被应用程序链接);</li>
<li><code>vcapp</code>：建立一个库的Visual Studio项目文件;</li>
<li><code>vclib</code>：建立一个库的Visual Studio项目文件;</li>
<li><code>subdirs</code>：这是一个特殊的模板，它可以创建一个能够进入特定目录并且为一个项目文件生成makefile并且为它调用make的makefile。</li>
</ul>
<h4 id="“app”模板"><a href="#“app”模板" class="headerlink" title="“app”模板"></a>“app”模板</h4><p>“app”模板告诉qmake为建立一个应用程序生成一个makefile，当使用这个模板时，下面这些qmake系统变量是被承认的，这些信息应该在你的<code>.pro</code>文件中指定好。</p>
<ul>
<li>HEADERS 应用程序中所有头文件的列表</li>
<li>SOURCES 应用程序中所有源文件的列表</li>
<li>FORMS 应用程序中的所有<code>.ui</code>文件(由Qt设计器生成)的列表。</li>
<li>LEXSOURCES 应用程序中的所有lex源文件的列表。</li>
<li>YACCSOURCES 应用程序中的所有yacc源文件的列表。</li>
<li>TARGET 可执行应用程序的名称，默认值为项目文件的名称。(如果需要扩展名，会自动被加上。)</li>
<li>DESTDIR 放置可执行程序目标的目录。</li>
<li>DEFINES 应用程序所需的额外的预处理程序定义的列表。</li>
<li>INCLUDEPATH 应用程序所需的额外的包含理解路径的列表。</li>
<li>DEPENDPATH 应用程序所依赖的搜索路径。</li>
<li>VPATH 寻找补充文件的搜索路径。</li>
<li>DEF_FILE 仅Windows需要：应用程序所需要连接的<code>.def</code>文件。</li>
<li>RC_FILE 仅windows需要：应用程序所需要的资源文件。</li>
<li>RES_FILE 仅windows需要：应用程序所要连接的资源文件。</li>
</ul>
<p>如果不需要任何额外的INCLUDEPATH,那么就不需要指定它，<code>qmake</code>会提供默认值，实际的项目文件可能是下面这个样子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">TEMPLATE = app</span><br><span class="line">DESTDIR = c:\helloapp</span><br><span class="line">HEADERS += hello.h</span><br><span class="line">SOURCES += hello.cpp \</span><br><span class="line">			main.cpp</span><br><span class="line">DEFINES += QT_DLL</span><br><span class="line">CONFIG += qt warn_on release</span><br></pre></td></tr></table></figure></p>
<p><strong>Note</strong>:如果条目是单值的，如template或工程目录，用“=”赋值;但如果是多值条目，使用”+=”来为这个类型添加条目。</p>
<h4 id="“lib”模板"><a href="#“lib”模板" class="headerlink" title="“lib”模板"></a>“lib”模板</h4><p>“lib”模板告诉qmake为建立一个库而生成makefile(根据makefile进行make之后库会被编译成可调用格式)，除了”app”模板中提到的系统变量，<strong>还有一个VERSION是被支持的</strong>，也需要在”.pro”文件中使用它们</p>
<ul>
<li>VERSION 目标库的版本号，如2.3.1。</li>
</ul>
<h4 id="“subdirs”模板"><a href="#“subdirs”模板" class="headerlink" title="“subdirs”模板"></a>“subdirs”模板</h4><p>“subdirs”模板告诉qmake生成一个makefile，可以进入到特定子目录并为这个目录中的项目文件生成makefile并为它调用make。</p>
<p>在这个模板中只有一个系统变量<em>SUBDIRS</em>可以被识别，这个变量中包含了所要处理的含有项目文件的子目录的列表。这个项目文件的名称和子目录是同名的，这样qmake就可以发现它，如，子目录名是”myapp”，则目录中的项目文件就该叫做<code>myapp.pro</code>。</p>
<h3 id="CONFIG变量"><a href="#CONFIG变量" class="headerlink" title="CONFIG变量"></a>CONFIG变量</h3><p>配置变量指定了编译器所要使用的选项和所需要被连接的库。配置变量的下面这些选项可以被qmake识别。</p>
<ul>
<li><p>这些选项控制着编译器相关标志</p>
<ul>
<li><code>release</code> 应用程序以release模式连编，如果”debug”被指定，它将被忽略(优先级低于debug)。</li>
<li><code>debug</code> 应用程序以debug模式连编。</li>
<li><code>warn_on</code> 编译器会输出尽可能多的警告信息，如”warn_off”被指定，它将被忽略</li>
</ul>
</li>
<li><p>这些选项定义了所需要连编的库/应用程序的类型</p>
<ul>
<li><code>qt</code> 应用程序是一个Qt应用程序(非console)，则Qt库会被连接;</li>
<li><code>thread</code> 应用程序是一个多线程应用程序;</li>
<li><code>X11</code> 应用程序是一个X11应用程序或库;</li>
<li><code>windows</code> 只用于“app”模板：应用程序是一个窗口应用程序;</li>
<li><code>console</code> 只用于“app”模板：应用程序是一个控制台应用程序;</li>
<li><code>dll</code> 只用于“lib”模板：库是一个共享库(dll);</li>
<li><code>staticlib</code> 只用于“lib”模板：库是一个静态库。</li>
<li><code>plugin</code> 只用于“lib”模板：库是一个插件，这将会使dll选项生效。</li>
</ul>
</li>
</ul>
<p>那比如，如果你的应用程序使用Qt库，并且你想把它连编为一个可调试的多线程的应用程序，<code>pro</code>文件中的CONFIG就应该如下设置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CONFIG += qt thread debug</span><br></pre></td></tr></table></figure></p>
<p><strong>注意</strong>：必须使用”+=”号。</p>
<h2 id="手动安装qmake"><a href="#手动安装qmake" class="headerlink" title="手动安装qmake"></a>手动安装qmake</h2><p>当Qt被连编时，默认情况下qmake也会被连编。<br>在手工连编Qt之前，下面<strong>这些环境变量必须被设置</strong>：<br>在设置QMAKESPEC时，可以从下面的可能的环境变量列表中进行选择(在<code>/usr/lib/x86_64-linux-gnu/qt5/mkspecs</code>可以查看到各平台的<code>qmake.conf</code>)：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">aix-64 hpux-64 irix-032 netbsd-g++ solaris-cc unixware7-g++ aix-g++ hpux-g++</span><br><span class="line">linux-cxx openbsd-g++ solaris-g++ win32-borland aix-xlc hpux-n64 linux-g++</span><br><span class="line">openunix-cc sunos-g++ win32-g++ bsdi-g++ hpubx-o64 linux-icc qnx-g++ tru64-cxx</span><br><span class="line">win32-msvc dgux-g++ hurd-g++ linux-kcc reliant-64 tru64-g++ win32-watc freebsd-g++</span><br><span class="line">irix-64 macx-pbuilder reliant-cds ultrix-g++ win32-visa hpux-acc irix-g++ macx-g++</span><br><span class="line">sco-g++ unixware-g hpubx-acc irix-n32 solaris-64 uninxware7-cc</span><br></pre></td></tr></table></figure></p>
<p><img src="pics/qt_makespec.png" alt="makespec"></p>
<p>当envvar是以下之一时，环境变量要设置到<code>qws/envvar</code>:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">linux-arm-g++ linux-generic-g++ linux-mips-g++ linux-x86-g++ linux-freebsd-g++ </span><br><span class="line">linux-ipaq-g++ linux-solaris-g++ qnx-rtp-g++</span><br></pre></td></tr></table></figure></p>
<ul>
<li><code>QTDIR</code>:必须设置到Qt被安装(或将被安装)到的地方。<br>在上述环境变量被设置后，在自己的编译环境下运行<code>make</code>(linux)或者<code>nmake</code>(win)。此时<code>qmake</code>就可以使用了。</li>
</ul>
<h2 id="10分钟学会使用qmake"><a href="#10分钟学会使用qmake" class="headerlink" title="10分钟学会使用qmake"></a>10分钟学会使用qmake</h2><h3 id="1-创建一个项目文件"><a href="#1-创建一个项目文件" class="headerlink" title="1. 创建一个项目文件"></a>1. 创建一个项目文件</h3><p><code>qmake</code>使用储存在项目(<code>.pro</code>)文件中的信息来决定Makefile中应该生成什么。</p>
<p>一个基本的项目文件包含关于应用程序的信息，如编译应用程序需要哪些文件，并且使用哪些基本配置设置。</p>
<ul>
<li>一个简单的示例项目文件<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SOURCES = hello.cpp</span><br><span class="line">HEADERS = hello.h</span><br><span class="line">CONFIG += qt warn_on release</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>对以上例子进行解析：</p>
<ul>
<li><code>SOURCES = hello.cpp</code>：<strong>指定实现应用程序的源文件程序</strong>。<em>当有多个文件时</em></li>
</ul>
<ol>
<li><p>可以把所个文件列在一行中，以空格分隔，如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SOURCES = hello.cpp main.cpp</span><br></pre></td></tr></table></figure>
</li>
<li><p>又或者将每个文件列在一个分开的行中，通过反斜线<code>\</code>另起一行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SOURCES = hello.cpp \</span><br><span class="line">			main.cpp</span><br></pre></td></tr></table></figure>
</li>
<li><p>或者单独列出每一个文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SOURCES += hello.cpp</span><br><span class="line">SOURCES += main.cpp</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ul>
<li><p><code>HEADERS = hello.h</code>：<strong>指定为这个应用程序创建的头文件</strong>。当有多个文件时，上述适用<code>SOURCES</code>的方法也一样适用于<code>HEADERS</code>文件。</p>
</li>
<li><p><code>CONFIG += qt warn_on release</code>：<strong>告诉qmake</strong>关于应用程序的配置信息。<em>用<code>+=</code>添加选项比做<code>=</code>替换是安全得多的</em>。</p>
<ul>
<li><code>qt</code>部分：告诉<code>qmake</code>这个应用程序是使用Qt来连编的，即<code>qmake</code>在为连接和为编译添加所需要的包含路径时就会考虑到Qt库;</li>
<li><code>warn_on</code>部分：告诉<code>qmake</code>把编译器设置为输出警告信息;</li>
<li><code>release</code>部分：告诉<code>qmake</code>应用程序需要被连编成一个发布的应用程序。那在开发过程中，也可以用<code>debug</code>来替换这里的<code>release</code>;</li>
</ul>
</li>
</ul>
<p><strong>项目文件就是扩展名为<code>.pro</code>的纯文本文件</strong>，<code>qmake</code>就是根据这个文件确定不同平台下项目的连编规则。发布的应用程序的执行文件的名称必须和项目文件的名称一样，但是扩展名是跟着平台而改变的。举例来说，一个叫做”hello.pro”的项目文件将会在Windows下生成<code>hello.exe</code>，而在Unix下生成”hello”。</p>
<h3 id="2-生成Makefile"><a href="#2-生成Makefile" class="headerlink" title="2. 生成Makefile"></a>2. 生成Makefile</h3><p>根据<code>.pro</code>项目文件，用<code>qmake</code>就可以生成Makefile：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qmake -o Makefile hello.pro</span><br></pre></td></tr></table></figure></p>
<p>对于VS用户，<code>qmake</code>也可以生成<code>.dsp</code>(developer studio project)文件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qmake -t vcapp -o hello.dsp hello.pro</span><br></pre></td></tr></table></figure></p>
<h2 id="qmake教程"><a href="#qmake教程" class="headerlink" title="qmake教程"></a>qmake教程</h2><h3 id="pro文件编写配合qmake和make使用"><a href="#pro文件编写配合qmake和make使用" class="headerlink" title="pro文件编写配合qmake和make使用"></a>pro文件编写配合<code>qmake</code>和<code>make</code>使用</h3><p>以一个工程实现一个qmake的编写(在qtcreator中创建工程时，所有的配置信息都会被qt自动在<code>.pro</code>中写好)。当你的工程已经创建了以下文件：</p>
<ul>
<li><code>hello.cpp</code></li>
<li><code>hello.h</code></li>
<li><code>main.cpp</code></li>
</ul>
<p>我们按照以下顺序编写项目的<code>.pro</code>文件：</p>
<ul>
<li><p>添加源文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SOURCES += hello.cpp \</span><br><span class="line">			main.cpp</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加头文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HEADERS += hello.h</span><br></pre></td></tr></table></figure>
</li>
<li><p>目标名称</p>
<ul>
<li>会被设置为和项目文件一样的名称，但是为了适合平台所需要的后缀。如，win下应该目标名称为“hello.exe”，在Unix下应该是“hello”。</li>
<li>如果想为项目设置一个不同的名字，可以在项目文件中设置它：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TARGET = helloworld</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>设置<code>CONFIG</code>变量(当在qtcreator中创建工程时，配置信息在进行工程生成时已经被用户选择好且将相关信息配置到<code>pro</code>文件中)</p>
<ul>
<li>因为这是个qt程序，我们需要把”qt”放到CONFIG这一行中，这样<code>qmake</code>才会在连接时添加相关的库，并且保证<code>moc</code>和<code>uic</code>的连编行也被包含到Makefile中。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CONFIG += qt</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><code>pro</code>文件编写完成后，可以在应用程序目录下的命令行中输入<code>qmake</code>命令来为应用程序生成<code>Makefile</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qmake -o Makefile hello.pro</span><br></pre></td></tr></table></figure>
</li>
<li><p>根据自己使用的编译器，输入<code>make</code>或者<code>nmake</code>。</p>
</li>
</ul>
<h3 id="使程序可以调试"><a href="#使程序可以调试" class="headerlink" title="使程序可以调试"></a>使程序可以调试</h3><p>应用程序的发布版本不包含任何调试符号或其他调试信息(发行版本进行了代码优化，也是为了运行流畅)。</p>
<p>在开发过程中，要是要生成一个含有相关调试信息的应用程序的调试版本，只要在项目文件的<code>CONFIG</code>变量中添加一个”debug”就可以简单实现。比如对于<code>hello.pro</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CONFIG += qt debug</span><br><span class="line">HEADERS += hello.h</span><br><span class="line">SOURCES += hello.cpp</span><br><span class="line">SOURCES += main.cpp</span><br></pre></td></tr></table></figure></p>
<p>再<code>qmake -o Makefile hello.pro</code>就可以生成相应的<code>Makefile</code>，再用<code>make</code>或<code>nmake</code>就可以生成debug版本的可执行程序了。</p>
<h3 id="添加特定平台的源文件"><a href="#添加特定平台的源文件" class="headerlink" title="添加特定平台的源文件"></a>添加特定平台的源文件</h3><p>应用程序中与平台相关的文件，如现在有两个新文件<code>hello_win.cpp</code>、<code>hello_x11.cpp</code>要添加到项目中，不能仅仅添加到<code>SOURCES</code>变量中就结束，因为那会把两个文件都添加到Makefile中。这里需要做的事是<strong>根据<code>qmake</code>所运行的平台来使用相应的作用域进行处理</strong>。</p>
<ul>
<li><strong>为Windows平台添加的平台依赖的文件</strong>的简单的作用域看起来如下：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">win32&#123;</span><br><span class="line">	SOURCES += hello_win.cpp</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>当<code>qmake</code>运行在windows上，它会把<code>hello_win.cpp</code>添加到源文件列表中，如果<code>qmake</code>运行在其他平台时，这部分就会被跳过。</p>
<ul>
<li><strong>添加一个X11依赖文件的作用域</strong><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x11&#123;</span><br><span class="line">	SOURCES += hello_x11.cpp</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>之后像前面一样使用<code>qmake</code>来生成Makefile，之后是<code>make</code>/<code>nmake</code>。此时项目文件应该像下面这样：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">CONFIG += qt debug</span><br><span class="line">HEADERS += hello.h</span><br><span class="line">SOURCES += hello.cpp \</span><br><span class="line">			main.cpp</span><br><span class="line">win32&#123;</span><br><span class="line">	SOURCES += hello_win.cpp</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">x11&#123;</span><br><span class="line">	SOURCES += hello_x11.cpp</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="如果一个指定文件不存在，停止qmake"><a href="#如果一个指定文件不存在，停止qmake" class="headerlink" title="如果一个指定文件不存在，停止qmake"></a>如果一个指定文件不存在，停止qmake</h3><p>当某个文件不存在时，也许不想生成一个Makefile。</p>
<p>我们可以通过使用<code>exists()</code>函数来检查一个文件是否存在，然后使用<code>error()</code>函数把正在运行的<code>qmake</code>停下来，这和作用域的工作方式一样，只是要将这个函数替换作用域条件。<em>其实前面的作用域条件都是bool值,bool值为真就执行作用域中语句，否则不执行</em>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">!exists(main.cpp)&#123;</span><br><span class="line">	error(&quot;No main.cpp file found&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那么此时使用<code>qmake</code>生成Makefile文件，当缺少<code>main.cpp</code>文件时，error信息显示，并且<code>qmake</code>会停止处理。</p>
<h3 id="检查多于一个的条件"><a href="#检查多于一个的条件" class="headerlink" title="检查多于一个的条件"></a>检查多于一个的条件</h3><p>假设使用Windows并且在命令行运行你的应用程序时你想<strong>显示debug语句</strong>，这就需要在连编程序时使用console设置，否则看不到输出，将<code>console</code>添加到CONFIG行中。那如果我们想要(1)在程序运行在win下;(2)且debug在CONFIG行中时;添加console。</p>
<ul>
<li><p>这就需要两个嵌套的作用域，然后将设置放在最里面的作用域中，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">win32&#123;</span><br><span class="line">	debug&#123;</span><br><span class="line">		CONFIG += console</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>嵌套的作用域也可以使用冒号连接起来</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">win32:debug&#123;</span><br><span class="line">	CONFIG += console</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>到这里，你就已经准备好为你的开发项目写项目文件了。</p>
<h2 id="qmake高级概念–语法"><a href="#qmake高级概念–语法" class="headerlink" title="qmake高级概念–语法"></a>qmake高级概念–语法</h2><p>qmake提供了更强大的功能，如可以使用一个简单的项目文件为多个平台生成makefile。</p>
<h3 id="操作符"><a href="#操作符" class="headerlink" title="操作符"></a>操作符</h3><ul>
<li><code>=</code> 简单分配一个值给一个变量，如同赋值操作(<strong>覆盖</strong>原有值)</li>
<li><code>+=</code> 向一个变量的值的列表中<strong>添加</strong>一个值。 </li>
<li><code>-=</code> 从一个变量的值的列表中移去一个值。</li>
<li><code>*=</code> 仅在一个值<strong>不存在</strong>于一个变量的值的列表中时，把它<strong>添加</strong>进去。如<code>DEFINES *= QT_DLL</code>只在QT_DLL未被定义在预处理定义的列表中时，才被添加进去。</li>
<li><code>~=</code> 替换任何与指定正则表达式匹配的任何值(与vim命令相同，模板匹配替换)。如<code>DEFINES ~= s/QT_[DT].+/QT</code>对所有QT_D或QT_T开头的变量，替换成QT。</li>
</ul>
<h3 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h3><p>功能类似于条件判断语句，当前面的表达式为bool真，作用域中的语句会被执行。</p>
<ul>
<li><p>例如，以下语句作用是在windows下使用qmake时，将QT_DLL添加到makefile中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">win32&#123;</span><br><span class="line">	DEFINES += QT_DLL</span><br><span class="line">&#125;</span><br><span class="line"># 也可以用冒号换成以下形式表示</span><br><span class="line">win32:DEFINES += QT_DLL</span><br></pre></td></tr></table></figure>
</li>
<li><p>又比如在除了win平台以外的平台做些处理，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">!win32&#123;</span><br><span class="line">	DEFINES += QT_DLL</span><br><span class="line">&#125;</span><br><span class="line"># 或者</span><br><span class="line">!win32:DEFINES += QT_DLL</span><br></pre></td></tr></table></figure>
</li>
<li><p>CONFIG行中任何条目都是一个作用域。如<code>CONFIG += warn_on</code>其中的<code>warn_on</code>就是一个作用域。这个特性使得考虑所有可能的编译器标志成为可能：可以针对不同编译器标志采取不同的措施，使项目易于维护和移植。如下例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CONFIG += qt warn_on debug</span><br><span class="line">debug&#123;</span><br><span class="line">	TARGET = myappdebug</span><br><span class="line">&#125;</span><br><span class="line">release&#123;</span><br><span class="line">	TARGET = myapp</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>也可以<strong>定义嵌套作用域</strong>，为避免写出过多嵌套作用域，可以<strong>使用冒号来嵌套作用域</strong>。如以下语句检查平台是windows且线程设置是否设定。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">win32&#123;</span><br><span class="line">	thread&#123;</span><br><span class="line">		DEFINES += QT_THREAD_SUPPORT</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"># 用冒号嵌套作用域</span><br><span class="line">win32:thread&#123;</span><br><span class="line">	DEFINES += QT_THREAD_SUPPORT</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>还可以用<code>else</code>作用域提供替代声明，当之前的作用域是false时，对应的<code>else</code>作用域会被处理。</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">win32:xml&#123;</span><br><span class="line">	message(Building for Windows)</span><br><span class="line">	SOURCES += xmlhandler_win.cpp</span><br><span class="line">&#125;else:xml&#123;</span><br><span class="line">	SOURCES += xmlhandler.cpp</span><br><span class="line">&#125;else&#123;</span><br><span class="line">	message(&quot;Unknown configuration&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><p>除了DEFINE、SOURCES和HEADERS这些系统变量外，用户还可以创建自己的变量，然后在作用域中使用它们。<br>当对一个给定的名字进行赋值时，qmake就会<strong>创建新的变量</strong>。例如<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MY_VARIABLE = value</span><br></pre></td></tr></table></figure></p>
<p>也可以通过在其他任何一个变量的变量名前加<code>$$</code>来把这个变量的值分配给当前的变量。例如<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MY_DEFINES = $$DEFINES</span><br></pre></td></tr></table></figure></p>
<p>现在MY_DEFINES变量包含了项目文件在此时DEFINES变量的值，这也和下面的语句等价：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MY_DEFINES = $$&#123;DEFINES&#125;</span><br></pre></td></tr></table></figure></p>
<p>第二种方法允许你将变量的内容附加到另一个值后，而不在两者之间添加空格(相当于拼接)。比如<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TARGET = myproject_$$&#123;TEMPLATE&#125;</span><br></pre></td></tr></table></figure></p>
<p>变量可以被用于存储环境变量的内容，这些值在<code>qmake</code>被运行时会被评估(evaluated)，或者会被包含在生成的Makefile中而在项目被构建时进行评估。</p>
<p>要在运行qmake时获取环境变量的内容，使用<code>$$(...)</code>操作符：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DESTDIR = $$(PWD)</span><br><span class="line">message(The project will be installed in $$DESTDIR)</span><br></pre></td></tr></table></figure></p>
<p>在上面的赋值中，PWD环境变量的值会在工程文件被处理时被读出。</p>
<p>如果要在处理生成的Makefile时才去获取一个环境变量的值，使用<code>$(...)</code>操作符，<em>推测主要差别是什么时候用常量值去取代变量，节省空间</em>：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">DESTDIR = $$(PWD)</span><br><span class="line">message(The project will be installed in $$DESTDIR)</span><br><span class="line"></span><br><span class="line">DESTDIR = $(PWD)</span><br><span class="line">message(The project will be installed in the value of PWD)</span><br><span class="line">message(when the Makefile is processed)</span><br></pre></td></tr></table></figure></p>
<p>在上述的赋值操作中，<code>PWD</code>的值在项目文件(<code>pro</code>文件)被处理时会立即被读出，但是$(PWD)会在生成的Makefile中被赋值给<code>DESTDIR</code>。这使得构建过程更加灵活，只要环境变量在Makefile被处理时被正确设置了的话。</p>
<p>还有一个特殊的<code>$$[...]</code>操作符，可以被用来获取构建Qt时不同的设置选项。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">message(Qt version:$$[QT_VERSION])</span><br><span class="line">message(Qt is installed in $$[QT_INSTALL_PREFIX])</span><br><span class="line">message(Qt resources can be found in the following loacations:)</span><br><span class="line">message(Documentation:$$[QT_INSTALL_DOCS])</span><br><span class="line">message(Header files:$$[QT_INSTALL_HEADERS])</span><br><span class="line">message(Libraries:$$[QT_INSTALL_LIBS])</span><br><span class="line">message(Binary files(executables):$$[QT_INSTALL_BINS])</span><br><span class="line">message(Plugins:$$[QT_INSTALL_PLUGINS])</span><br><span class="line">message(Data files:$$[QT_INSTALL_DATA])</span><br><span class="line">message(Translation files:$$[QT_INSTALL_TRANSLATIONS])</span><br><span class="line">message(Settings:$$[QT_INSTALL_SETTINGS])</span><br><span class="line">message(Examples:$$[QT_INSTALL_EXAMPLES])</span><br><span class="line">message(Demonstrations:$$[QT_INSTALL_DEMOS])</span><br></pre></td></tr></table></figure></p>
<p>可以通过这个操作符获取的变量，经常被用于使得整合到Qt中的第三方的插件和组件可用。比如说，按照下面的声明，一个Qt Designer插件可以被安装为Qt Designes的内建插件目录下。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">target.path = $$[QT_INSTALL_PLUGINS]/designer</span><br><span class="line">INSTALLS += target</span><br></pre></td></tr></table></figure></p>
<h3 id="变量处理函数"><a href="#变量处理函数" class="headerlink" title="变量处理函数"></a>变量处理函数</h3><p><code>qmake</code>提供了一系列内建函数来处理变量的内容，这些函数处理提供给它们的变量并且返回一个值，或者一个列表的值作为结果。为了能将值赋给一个变量，<strong>需要<code>$$</code>操作符来进行变量内容的取值</strong>赋值操作。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HEADERS = model.h</span><br><span class="line">HEADERS += $$OTHER_HEADERS</span><br><span class="line">HEADERS = $$unique(HEADERS)</span><br></pre></td></tr></table></figure></p>
<p>有可能需要一个你自己的函数，用于处理变量的内容，这些函数按照如下方式定义：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">defineReplace(functionName)&#123;</span><br><span class="line">	#function code</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>下面给出一个示例函数：输入一个变量名，用内建的<code>eval()</code>函数从中提取一系列值，并且编译一系列文件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">defineReplace(headersAndSources)&#123;</span><br><span class="line">	variable = $$1</span><br><span class="line">	names = $$eval($$variable)</span><br><span class="line">	headers = </span><br><span class="line">	sources =</span><br><span class="line"></span><br><span class="line">	for(name,names)&#123;</span><br><span class="line">		header = $$&#123;name&#125;.h</span><br><span class="line">		exists($$header)&#123;</span><br><span class="line">			headers += $$header</span><br><span class="line">		&#125;</span><br><span class="line">		source = $$&#123;name&#125;.cpp</span><br><span class="line">		exists($$source)&#123;</span><br><span class="line">			sources += $$source</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	return($$headers $$sources)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="测试函数"><a href="#测试函数" class="headerlink" title="测试函数"></a>测试函数</h3><p>qmake提供了一些测试函数，这些函数也可以用作书写作用域时的条件，这些函数不返回一个值，而是指示着”success”或者”failure”(bool值)。</p>
<ul>
<li><p><code>contains(variablename,value)</code>:如果value存在于一个叫做variablename的变量的值的列表中，则执行作用域中内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">contains(VCONFIG,thread)&#123;</span><br><span class="line">	DEFINES += QT_THREAD_SUPPORT</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>count(variablename,number)</code>:如果variablename变量的值的总数是number个，那么这个作用域中的设置会被执行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">count(DEFINES, 5)&#123;</span><br><span class="line">	CONFIG += debug</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>error(string)</code>：输出指定字符串，然后使qmake退出。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error(&quot;An error has occured&quot;)</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>exists(filename)</code>:如果指定文件存在，那么这个作用域中的设置会被处理。<strong>注意:可以不用考虑平台,一致使用<code>/</code>作为目录的分隔符</strong>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">exists(/local/qt/qmake/main.cpp)&#123;</span><br><span class="line">	SOURCES += main.cpp</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>include(filename)</code>:项目文件在执行到此语句时包含这个文件名的内容，那么作用域中的设置被执行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">include(myotherapp.pro)&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>isEmpty(variablename)</code>:如果variablename变量中没有任何元素，那么这个作用域中的设置会被处理。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">isEmpty(CONFIG)&#123;</span><br><span class="line">	CONFIG += qt warn_on debug</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>system(command)</code>:指令执行且如果返回值为1,则作用域中内容被执行。</p>
</li>
<li><code>infile(filename,var,val)</code>：如果filename文件包含一个值为val的变量var，那么这个函数将返回成功，第三个参数val省略时，只测试文件中是否有这样一个变量。</li>
</ul>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="http://read.pudn.com/downloads137/sourcecode/embed/583560/qt%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/qmake%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C.pdf" target="_blank" rel="noopener">qmake用户手册</a></li>
<li><a href="http://doc.qt.io/qt-5/qmake-manual.html" target="_blank" rel="noopener">官方qmake manual</a></li>
</ul>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2018/07/10/qmake手册记录/">qmake手册记录</a></p>
        <p><span>文章作者:</span><a href="/" title="回到主页">Yuci Cheung</a></p>
        <p><span>发布时间:</span>2018-07-10, 00:16:08</p>
        <p><span>最后更新:</span>2018-07-10, 00:33:54</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2018/07/10/qmake手册记录/" title="qmake手册记录">https://yucicheung.github.io/2018/07/10/qmake手册记录/</a>
            <span class="copy-path" data-clipboard-text="原文: https://yucicheung.github.io/2018/07/10/qmake手册记录/　　作者: Yuci Cheung" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/2018/08/17/书籍推荐/">
                    书籍推荐
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2018/07/10/cmake笔记/">
                    cmake笔记
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#qmake相关基本概念"><span class="toc-number">1.</span> <span class="toc-text">qmake相关基本概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#几个名词说明"><span class="toc-number">1.1.</span> <span class="toc-text">几个名词说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#模板"><span class="toc-number">1.2.</span> <span class="toc-text">模板</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#“app”模板"><span class="toc-number">1.2.1.</span> <span class="toc-text">“app”模板</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#“lib”模板"><span class="toc-number">1.2.2.</span> <span class="toc-text">“lib”模板</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#“subdirs”模板"><span class="toc-number">1.2.3.</span> <span class="toc-text">“subdirs”模板</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CONFIG变量"><span class="toc-number">1.3.</span> <span class="toc-text">CONFIG变量</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#手动安装qmake"><span class="toc-number">2.</span> <span class="toc-text">手动安装qmake</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10分钟学会使用qmake"><span class="toc-number">3.</span> <span class="toc-text">10分钟学会使用qmake</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-创建一个项目文件"><span class="toc-number">3.1.</span> <span class="toc-text">1. 创建一个项目文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-生成Makefile"><span class="toc-number">3.2.</span> <span class="toc-text">2. 生成Makefile</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#qmake教程"><span class="toc-number">4.</span> <span class="toc-text">qmake教程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#pro文件编写配合qmake和make使用"><span class="toc-number">4.1.</span> <span class="toc-text">pro文件编写配合qmake和make使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使程序可以调试"><span class="toc-number">4.2.</span> <span class="toc-text">使程序可以调试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#添加特定平台的源文件"><span class="toc-number">4.3.</span> <span class="toc-text">添加特定平台的源文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#如果一个指定文件不存在，停止qmake"><span class="toc-number">4.4.</span> <span class="toc-text">如果一个指定文件不存在，停止qmake</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#检查多于一个的条件"><span class="toc-number">4.5.</span> <span class="toc-text">检查多于一个的条件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#qmake高级概念–语法"><span class="toc-number">5.</span> <span class="toc-text">qmake高级概念–语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#操作符"><span class="toc-number">5.1.</span> <span class="toc-text">操作符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#作用域"><span class="toc-number">5.2.</span> <span class="toc-text">作用域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#变量"><span class="toc-number">5.3.</span> <span class="toc-text">变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#变量处理函数"><span class="toc-number">5.4.</span> <span class="toc-text">变量处理函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#测试函数"><span class="toc-number">5.5.</span> <span class="toc-text">测试函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考资料"><span class="toc-number">6.</span> <span class="toc-text">参考资料</span></a></li></ol>
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-3 i,
        .toc-level-3 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

    <script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"false"];
    </script>



    
<div class="share">
    

    
        <div class="addthis_sharing_toolbox"></div>
    
</div>







    
        <section id="comments">
    <style> aside.comment-bar { margin: auto 30px; }</style>
    <div id="disqus_thread"></div>
    <script>
        var disqus_config = function(){
            this.page.url = 'https://yucicheung.github.io/2018/07/10/qmake手册记录/';
            this.page.identifier = '2018/07/10/qmake手册记录/';
        };
        var loadComment = function(){
            var d = document, s = d.createElement('script');
            s.src = '//yucicheung-github-io.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        }
    </script>
    
    <script> loadComment(); </script>

</section>


    




    <div class="scroll" id="post-nav-button">
        
            <a href="/2018/08/17/书籍推荐/" title="上一篇: 书籍推荐">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2018/07/10/cmake笔记/" title="下一篇: cmake笔记">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/09/07/C++多线程初探：thread、atomic及mutex的配合使用/">C++多线程初探：thread、atomic及mutex的配合使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/18/设计模式概览/">设计模式概览</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/18/C++相关知识点及建议总结(二)/">C++相关知识点及建议总结(二)</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/18/C++相关知识点及建议总结(一)/">C++相关知识点及建议总结(一)</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/17/书籍推荐/">书籍推荐</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/10/qmake手册记录/">qmake手册记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/10/cmake笔记/">cmake笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/05/Windows及Ubuntu软件包管理器安装qt5记录/">Windows及Ubuntu软件包管理器安装qt5记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/30/CelexMatlabToolbox-1-0发布记录/">CelexMatlabToolbox-1.0发布记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/13/微信定时自动发送群消息的小工具/">微信定时自动发送群消息的小工具-python-itchat</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/25/更改Ubuntu的apt源/">更改Ubuntu的apt源</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/25/tmux-Usage/">tmux的安装和使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/11/建库时帮助筛选图片的GUI小工具-python-tkinter/">建库时帮助筛选图片的GUI小工具(python+tkinter)</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/09/Linux系列11-Shell编程/">Linux系列11-Shell编程</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/09/Linux系列10-VIM/">Linux系列10-Linux编程</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/09/Linux系列9-网络配置和远程访问/">Linux系列9-网络配置和远程访问</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/09/Linux系列8-进程管理/">Linux系列8-进程管理</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/09/Linux系列7-用户与用户组管理/">Linux系列7-用户与用户组管理</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/09/Linux系列6-磁盘管理/">Linux系列6-磁盘管理</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/09/Linux系列5-软件包管理/">Linux系列5-软件包管理</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/09/Linux系列4-文件目录管理/">Linux系列4-文件目录管理</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/09/Linux系列3-shell基本命令/">Linux系列3-shell基本命令</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/09/Linux系列2-基本配置/">Linux系列2-基本配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/09/Linux系列1-概述/">Linux系列1-概述</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/24/Dijkstras算法和实现/">Dijkstras算法和实现(python)</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/17/python中的argv和argc/">python中的argv和argc</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/14/为Github-page绑定自定义域名并实现https访问/">为Github page绑定自定义域名并实现https访问</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/13/Ubuntu下用hexo搭建github博客/">Ubuntu下用hexo搭建github博客</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2018 Yuci Cheung
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
    <script src="/js/GithubRepoWidget.js"></script>

<script data-main="/js/main.js" src="//cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 6;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>



<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-115529402-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->



    <script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
             github: ".github-widget a", 
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

    <script>
        var originTitle = document.title;
        var titleTime;
        document.addEventListener("visibilitychange", function() {
            if (document.hidden) {
                document.title = "(つェ⊂)" + originTitle;
                clearTimeout(titleTime);
            }
            else {
                document.title = "(*´∇｀*)" + originTitle;
                titleTime = setTimeout(function() {
                    document.title = originTitle;
                }, 2000);
            }
        })
    </script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>